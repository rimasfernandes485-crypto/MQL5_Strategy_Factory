name: ğŸ” ValidaÃ§Ã£o AutomÃ¡tica MQL5 (Base44 â†’ GitHub)

on:
  push:
    branches:
      - main
    paths:
      - 'Experts/**/*.mq5'
      - 'Include/**/*.mqh'

jobs:
  validar_codigo:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout do repositÃ³rio
        uses: actions/checkout@v4

      - name: âš™ï¸ Configurar ambiente Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸ“¦ Instalar dependÃªncias
        run: |
          pip install lxml pygments

      - name: ğŸ” Validar estrutura dos cÃ³digos MQL5
        run: |
          echo "Iniciando validaÃ§Ã£o de sintaxe dos arquivos MQL5..."
          python3 <<'EOF'
import os, re

def validar_codigo(codigo):
    erros = []
    if not "#property" in codigo:
        erros.append("Falta a diretiva #property no inÃ­cio.")
    if not re.search(r'(OnInit|OnDeinit|OnTick)', codigo):
        erros.append("Falta uma das funÃ§Ãµes principais (OnInit, OnDeinit, OnTick).")
    if codigo.count('{') != codigo.count('}'):
        erros.append("NÃºmero desigual de chaves '{' e '}'.")
    if "CTrade" not in codigo and "OrderSend" not in codigo:
        erros.append("Nenhuma funÃ§Ã£o de negociaÃ§Ã£o encontrada (CTrade ou OrderSend).")
    return erros

base_dirs = ["Experts", "Include"]
total_erros = 0

for pasta in base_dirs:
    if not os.path.exists(pasta):
        continue
    for root, _, files in os.walk(pasta):
        for f in files:
            if f.endswith((".mq5", ".mqh")):
                caminho = os.path.join(root, f)
                with open(caminho, "r", encoding="utf-8", errors="ignore") as arq:
                    conteudo = arq.read()
                erros = validar_codigo(conteudo)
                if erros:
                    print(f"\nâš ï¸ Avisos em {caminho}:")
                    for e in erros:
                        print("   -", e)
                    total_erros += 1

if total_erros == 0:
    print("\nâœ… Nenhum erro crÃ­tico encontrado nos cÃ³digos MQL5.")
else:
    print(f"\nâš ï¸ Total de arquivos com observaÃ§Ãµes: {total_erros}")
EOF

      - name: âœ… Resultado da verificaÃ§Ã£o
        run: echo "ValidaÃ§Ã£o concluÃ­da (modo tolerante). Nenhum bloqueio aplicado."
